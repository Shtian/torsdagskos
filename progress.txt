# Codebase Patterns
- Use `pnpm lint` (`biome check .`) for local validation and reserve `pnpm lint:ci` (`biome ci .`) for CI workflows.
- Full Playwright runs are most reliable with `pnpm test --workers=1` because many specs mutate shared DB state and can race in parallel.
- When restyling `src/pages/settings.astro`, keep `#permission-status`, `#saved-preference`, `#request-permission`, and `#feedback` IDs stable because the page script and settings specs depend on them.
- Keep event create/edit forms aligned on shadcn inline feedback (`data-test-id="form-feedback-panel"`) and assert panel text + submit busy/disabled states in Playwright instead of toast nodes.
- For global theme/token assertions, use an `@unauth` Playwright spec on `/access-denied` and validate computed styles from `document.documentElement` and `document.body` to keep tests deterministic.
- Keep a semantic heading element on `/access-denied`; theme and typography unauth specs read heading computed styles from that route.
- Load Google Fonts once in `src/layouts/Layout.astro` and map them via global CSS font tokens (`--font-heading`, `--font-body`) so typography stays consistent across all routes.
- When rendering React `Textarea` components from `.astro` pages, prefer `defaultValue` over children content to avoid accidental `"[object Object]"` rendering in SSR output.
- For Playwright interactions with `ShadcnIslandDemo`, wait for `data-hydrated="true"` on `data-test-id="shadcn-island"` before tab/select/dialog/dropdown actions to avoid pre-hydration flakes.
- Full Playwright runs can intermittently 401 in `tests/history.spec.ts` (`/api/test/current-user`) late in the suite; validate with an isolated rerun of that spec when this known auth-state flake appears.
- In auth-sensitive Playwright helpers that call `/api/test/current-user` inside `page.evaluate()`, guard for occasional 401/non-JSON responses and retry before hard-failing.
- Event detail RSVP UX now uses inline feedback (`data-test-id="rsvp-feedback-panel"` + `#rsvp-feedback`) and `aria-busy` button states; avoid toast-based assertions in RSVP tests.
- For UI migrations, keep behavior coverage in existing specs and add focused `*-ui.spec.ts` shells/mobile tests so visual refactors do not weaken functional assertions.
- For Norwegian localization stories, update accessible-name assertions and prefer test IDs for badge/count checks when translated labels overlap (for example `kommer` vs `kommer ikke`).
- After shadcn migration, remove unused Astro starter artifacts (`src/components/Welcome.astro`, `src/assets/*`) and stale global CSS selectors to avoid carrying duplicate legacy UI paths.
- Keep migration documentation synchronized between `README.md` conventions and `docs/shadcn-migration-checklist.md` mapping/status whenever UI primitives or exceptions change.
- For intermittent Playwright `page.goto()` detach/network abort flakes on local dev server, use a small bounded retry helper in the affected spec instead of increasing global timeouts.

## 2026-02-11 16:34:47 CET - US-001
- Implemented Astro React island support and shadcn scaffold foundations (React integration, aliasing, shadcn config, utility `cn`, and initial `Button` primitive).
- Rendered a React island (`ShadcnIslandDemo`) from `src/pages/index.astro` with `client:load` to validate Astro+React integration in a real page.
- Added Playwright coverage for the new UI integration in `tests/shadcn-island.spec.ts`.
- Files changed: `astro.config.mjs`, `tsconfig.json`, `package.json`, `pnpm-lock.yaml`, `components.json`, `src/lib/utils.ts`, `src/components/ui/button.tsx`, `src/components/ShadcnIslandDemo.tsx`, `src/pages/index.astro`, `tests/shadcn-island.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Astro React TSX components require `@types/react` and `@types/react-dom` in this repo for `pnpm astro check` to pass.
  - Existing test conventions and helper guidance in `tests/AGENTS.md` are accurate; new UI checks should follow `getByRole`/`getByTestId` patterns from there.
---
## 2026-02-11 16:42:43 CET - US-002
- Established a single-source global light-theme baseline in `src/styles/global.css` by formalizing semantic tokens for color, spacing, radius, typography, and elevation, and adding shadcn-compatible semantic aliases (`--background`, `--foreground`, `--card`, etc.).
- Applied token-driven baseline styles to root elements (`html`, `body`, headings, media, links) to remove hardcoded base defaults and ensure consistent styling behavior across pages.
- Added Playwright coverage in `tests/theme-baseline.spec.ts` to validate token presence and computed baseline styles on an unauthenticated route.
- Files changed: `src/styles/global.css`, `tests/theme-baseline.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`, `ralph.sh`.
- **Learnings for future iterations**
  - Keep core semantic aliases (`--background`, `--foreground`, `--primary`, `--ring`) defined alongside legacy `--color-*` tokens so older pages and shadcn primitives can coexist during migration.
  - Theme baseline tests are more stable when they run as `@unauth` against `/access-denied` and assert computed styles instead of auth-dependent page content.
  - Full suite reliability remains best with `pnpm test --workers=1`; auth-dependent specs can fail intermittently under competing state.
---
## 2026-02-11 16:48:38 CET - US-003
- Selected and integrated a polished Google Fonts pairing: `Lora` for headings and `Manrope` for body/UI text.
- Loaded font assets globally in `src/layouts/Layout.astro` with `preconnect` + stylesheet link, and wired typography roles through global tokens in `src/styles/global.css`.
- Documented the font choices and usage roles in `README.md`.
- Added Playwright coverage in `tests/typography-fonts.spec.ts` and updated baseline typography assertion in `tests/theme-baseline.spec.ts`.
- Files changed: `src/layouts/Layout.astro`, `src/styles/global.css`, `README.md`, `tests/theme-baseline.spec.ts`, `tests/typography-fonts.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Keep all font loading centralized in `src/layouts/Layout.astro` so every route inherits the same typography without per-page duplication.
  - Font-family Playwright assertions should use `toContain()` for the selected family name, since rendered stacks include browser-specific fallbacks.
- Run full Playwright verification with `pnpm test --workers=1` when validating UI stories to avoid parallel state races in this codebase.
---
## 2026-02-11 16:59:55 CET - US-004
- Added shadcn form primitives `Input`, `Label`, `Textarea`, and `Select`, plus a `src/components/ui/index.ts` barrel for consistent UI imports.
- Replaced event creation form controls in `src/pages/events/new.astro` with the new primitives while preserving existing IDs/names and submit behavior.
- Expanded the shadcn island demo to include a working `Select` and added Playwright assertions for the new select interaction and primitive slots.
- Files changed: `package.json`, `pnpm-lock.yaml`, `src/components/ui/input.tsx`, `src/components/ui/label.tsx`, `src/components/ui/textarea.tsx`, `src/components/ui/select.tsx`, `src/components/ui/index.ts`, `src/components/ShadcnIslandDemo.tsx`, `src/pages/events/new.astro`, `tests/event-creation.spec.ts`, `tests/shadcn-island.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Import shared UI primitives from `@/components/ui` to keep migration imports consistent across pages and islands.
  - For React form primitives rendered in Astro pages, preserve existing element IDs so current scripts and Playwright locators keep working without refactors.
  - `data-slot` attributes on shadcn primitives provide stable selectors for focused UI tests when role/text assertions are not specific enough.
---
## 2026-02-12 09:55:00 CET - US-005
- Added shadcn surface and feedback primitives: Card, Badge, Separator, and Skeleton components.
- Created EventCard React component to replace legacy event card markup with shadcn primitives on homepage.
- Enhanced ShadcnIslandDemo to showcase all four new components with interactive Skeleton toggle.
- Replaced custom event card HTML with EventCard islands on homepage (both upcoming and past events).
- Migrated RSVP count badges from custom styled spans to shadcn Badge components with semantic variants.
- Added Separator component between "Upcoming Events" and "Past Events" sections.
- Added comprehensive Playwright test coverage in `tests/surface-primitives.spec.ts` validating Card slots, Badge variants, Separator rendering, and Skeleton state toggling.
- Files changed: `package.json`, `pnpm-lock.yaml`, `src/components/ui/badge.tsx`, `src/components/ui/card.tsx`, `src/components/ui/separator.tsx`, `src/components/ui/skeleton.tsx`, `src/components/ui/index.ts`, `src/components/EventCard.tsx`, `src/components/ShadcnIslandDemo.tsx`, `src/pages/index.astro`, `tests/surface-primitives.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Use test fixtures `import { test, expect } from "./fixtures"` instead of manual sign-in in Playwright tests for authenticated routes.
  - When wrapping Astro pages with React islands for shadcn components, use `client:load` directive on the component in `.astro` files.
  - For EventCard components used as links, wrap shadcn Card with `<a>` element instead of making Card itself a link to preserve accessibility.
  - Use semantic HTML (h2) for card titles instead of div-based CardTitle when heading role is required for existing test compatibility.
  - Skeleton component requires explicit React import statement despite TSX file extension.
  - shadcn Separator uses `role="none"` for decorative separators (default `decorative={true}`), not `role="separator"`.
---
## 2026-02-12 10:27:00 CET - US-006
- Added shadcn interactive overlay primitives: Dialog, DropdownMenu, and Tabs components.
- Installed lucide-react dependency for icon support in shadcn components.
- Added ghost variant to Button component for icon-only button use cases.
- Enhanced ShadcnIslandDemo with tab-based interface showcasing all three overlay components:
  - Dialog with keyboard navigation (Escape to close, focus management)
  - DropdownMenu with keyboard navigation (Arrow keys, Escape to close)
  - Tabs with keyboard navigation (Arrow Left/Right, content switching)
- Added comprehensive Playwright test coverage in `tests/overlay-primitives.spec.ts`:
  - Tabs: rendering, switching, keyboard navigation
  - Dialog: open/close, Escape key, button interactions
  - DropdownMenu: open/close, Escape key, keyboard navigation, item selection
- Updated existing tests to work with new demo structure (tab-based layout).
- Files changed: `package.json`, `pnpm-lock.yaml`, `src/components/ShadcnIslandDemo.tsx`, `src/components/ui/button.tsx`, `src/components/ui/dialog.tsx`, `src/components/ui/dropdown-menu.tsx`, `src/components/ui/tabs.tsx`, `src/components/ui/index.ts`, `tests/overlay-primitives.spec.ts`, `tests/shadcn-island.spec.ts`, `tests/surface-primitives.spec.ts`, `tests/events.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - shadcn overlay components (Dialog, DropdownMenu, Tabs) require lucide-react for icons.
  - Dialog and DropdownMenu from shadcn/ui have built-in keyboard navigation and accessibility.
  - When restructuring React islands with tabs, update existing tests to navigate to the correct tab before assertions.
  - The ghost button variant is useful for icon-only buttons in UI components like dropdown triggers.
  - Radix UI primitives (used by shadcn) handle focus management and keyboard interactions automatically.
---
## 2026-02-12 10:54:00 CET - US-007
- Migrated app shell layout (header, footer, wrappers) to use shadcn component patterns and design tokens.
- Replaced custom-styled navigation buttons with shadcn buttonVariants() applied directly to anchor elements, preserving all navigation functionality.
- Updated header to use semantic shadcn tokens (bg-background, text-foreground, text-muted-foreground) for consistent theming.
- Enhanced Button component with Slot.Root for proper asChild support (merges props/classes to child elements).
- Set navigation buttons to lg size (h-11/44px) to meet touch-target accessibility requirements (44px minimum).
- Created comprehensive Playwright test suite in tests/app-shell.spec.ts covering header rendering, responsive behavior, accessibility (skip link), and main content structure.
- All app shell tests passing (5/5) and responsive touch-target test now passing.
- Files changed: src/layouts/Layout.astro, src/components/ui/button.tsx, tests/app-shell.spec.ts, prd.json, progress.txt.
- **Learnings for future iterations**
  - When using shadcn Button with asChild in Astro templates, applying buttonVariants() directly to <a> elements works better than wrapping in React islands for static navigation.
  - Navigation buttons need size="lg" (h-11/44px) to meet WCAG touch-target requirements on mobile (44px minimum).
  - Use getByRole('banner') instead of locator('header') in tests to avoid matching Astro dev toolbar elements.
  - Radix UI Slot.Root properly merges className and other props onto child elements when asChild={true}.
  - Pre-existing test failures in overlay-primitives and surface-primitives specs (7 failures) are unrelated to app shell changes.
---
## 2026-02-12 11:38:37 CET - US-008
- Migrated remaining homepage shell UI in `src/pages/index.astro` to shadcn-compatible surface/action patterns: tokenized card shells, shadcn-style separator, and `buttonVariants()`-driven duplicate action states while preserving event sort, links, and duplicate query behavior.
- Added frontend Playwright coverage in `tests/homepage-ui.spec.ts` for populated and empty homepage states, including section shell rendering and duplicate-action behavior.
- Stabilized React-island interaction tests by introducing a hydration marker (`data-hydrated`) in `ShadcnIslandDemo` and waiting for it before interaction in overlay/surface/island specs.
- Files changed: `src/pages/index.astro`, `tests/homepage-ui.spec.ts`, `src/components/ShadcnIslandDemo.tsx`, `tests/overlay-primitives.spec.ts`, `tests/shadcn-island.spec.ts`, `tests/surface-primitives.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Wait for React island hydration (`data-hydrated="true"`) before interacting with tabbed Radix content in Playwright; otherwise hidden-panel controls can intermittently time out.
  - Use direct-child selectors when asserting top-level `data-slot="card"` containers on pages that also embed card-based child components to avoid strict-locator collisions.
  - Homepage migration can preserve existing test contracts by keeping `Upcoming Events` and `Past Events` heading semantics while changing only shell styling primitives.
---
## 2026-02-12 11:59:15 CET - US-009
- Migrated `src/pages/access-denied.astro` to a shadcn-compatible card shell and shared action styling via `buttonVariants`, while preserving the existing access-restricted messaging and sign-in navigation behavior.
- Added frontend Playwright coverage in `tests/access-denied-ui.spec.ts` for baseline render, redirected `from` context rendering, and mobile overflow behavior.
- Files changed: `src/pages/access-denied.astro`, `tests/access-denied-ui.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Typography/theme tests in this repo rely on `/access-denied` for unauthenticated assertions, so keep the invite-only title as a semantic heading element when restyling that page.
  - For migrated Astro links styled with `buttonVariants`, assert role/name/href in Playwright instead of component-only `data-slot` attributes.
  - Mobile regression checks for single-card pages are cheap and effective using viewport + horizontal overflow assertions.
---
## 2026-02-12 12:15:48 CET - US-010
- Migrated `src/pages/sign-in.astro` wrapper UI to a shadcn-compatible card shell with shared tokenized hierarchy (kicker, title, description, content container) while preserving Clerk sign-in routing and authenticated redirect behavior.
- Added frontend Playwright coverage in `tests/sign-in-ui.spec.ts` to verify migrated wrapper content, preserved Clerk sign-in UI visibility, sign-up navigation link, and mobile overflow safety.
- Files changed: `src/pages/sign-in.astro`, `tests/sign-in-ui.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - For Clerk auth wrapper migrations, keep the Clerk component server-rendered inside the Astro shell and only restyle the surrounding container to avoid auth-flow regressions.
  - Pair wrapper assertions (`data-test-id`) with user-facing Clerk heading assertions so tests validate both local shell migration and external auth widget continuity.
  - `pnpm test --workers=1` still shows a known unrelated auth flake in `tests/history.spec.ts`; `pnpm test tests/history.spec.ts --workers=1` passes in isolation.
---
## 2026-02-12 14:07:09 CET - US-011
- Migrated `src/pages/sign-up.astro` wrapper UI to the shadcn-compatible card shell pattern used for auth pages, including tokenized hierarchy (kicker, title, description, content container) while preserving Clerk sign-up functionality and authenticated redirect behavior.
- Added frontend Playwright coverage in `tests/sign-up-ui.spec.ts` to verify migrated shell content, preserved Clerk sign-up visibility, sign-in navigation link, and mobile overflow safety.
- Files changed: `src/pages/sign-up.astro`, `tests/sign-up-ui.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - For Clerk sign-up wrapper migrations, keep the Clerk component server-rendered and migrate only the surrounding Astro shell to avoid introducing auth flow regressions.
  - Pair wrapper `data-test-id` assertions with user-facing Clerk heading assertions so tests validate both local shell migration and external auth UI continuity.
  - Full-suite Playwright validation remains stable with `pnpm test --workers=1` in this repo.
---
## 2026-02-12 14:43:53 CET - US-012
- Migrated `src/pages/events/new.astro` to a shadcn-compatible card shell with tokenized header/content/footer structure, shared action styling via `buttonVariants`, and updated duplicate-event notice styling while preserving form field IDs, submit API contract, and redirect behavior.
- Replaced legacy toast feedback on event creation with inline shadcn-style feedback states (`loading`, `success`, `error`) and ensured the submit control reflects disabled/busy/loading behavior during requests.
- Updated frontend Playwright coverage for event creation and dependent flows to assert the new shell and inline feedback patterns (`tests/event-creation.spec.ts`, `tests/accessibility-polish.spec.ts`, `tests/duplicate-event.spec.ts`), and stabilized history auth-state checks with retry guarding in `tests/history.spec.ts`.
- Added reusable Playwright guidance for auth-sensitive `/api/test/current-user` calls in `tests/AGENTS.md`.
- Files changed: `src/pages/events/new.astro`, `tests/event-creation.spec.ts`, `tests/accessibility-polish.spec.ts`, `tests/duplicate-event.spec.ts`, `tests/history.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Event form feedback in this codebase now uses inline status panels (`data-test-id="form-feedback-panel"`) instead of transient toast nodes; tests should assert user-visible panel text and submit button state.
  - When UI copy changes for duplicate-event banners, prefer focused substring assertions on stable meaning rather than exact phrase variants to avoid brittle failures.
  - Authenticated full-suite runs remain prone to intermittent `/api/test/current-user` 401 responses; handling retry in evaluate-based helpers substantially reduces flaky failures.
---
## 2026-02-12 17:40:08 CET - US-013
- Migrated `src/pages/events/[id]/edit.astro` to the shadcn card/form shell pattern used by event creation, replacing legacy form styling with shared `Button`, `Input`, `Label`, `Textarea`, and `buttonVariants` usage while preserving all existing field IDs, prefill behavior, and update API submission flow.
- Replaced edit-page toast messages with inline shadcn-compatible feedback states (`loading`, `success`, `error`) using the shared `form-feedback-panel` pattern and preserved redirect behavior after successful event updates.
- Added and updated Playwright coverage in `tests/event-edit.spec.ts` for migrated card shell structure, primitive slot rendering, success feedback path, and loading/disabled/error feedback behavior during save failures.
- Files changed: `src/pages/events/[id]/edit.astro`, `tests/event-edit.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Keep create/edit event forms visually and behaviorally aligned by sharing the same shadcn card sections (`data-slot="card-header|content|footer"`) and inline feedback contract.
  - For migrated update forms, assert inline feedback panel content and submit busy state transitions instead of waiting for transient success/error nodes.
  - Preserve existing form field IDs when migrating to shadcn primitives so API and test contracts remain stable.
---
## 2026-02-12 17:53:04 CET - US-014
- Migrated `src/pages/events/[id].astro` to a shadcn-compatible event detail shell using tokenized card sections, `buttonVariants` actions, and consistent RSVP/status/count/list surface patterns while preserving all existing event data rendering and RSVP action contracts.
- Replaced RSVP toast messaging with inline feedback states (`loading`, `success`, `error`) via `data-test-id="rsvp-feedback-panel"` and preserved button disable/busy + reload behavior after successful RSVP updates.
- Added frontend Playwright coverage in `tests/event-detail-ui.spec.ts` for migrated shell rendering, past-event behavior, and mobile overflow safety; updated RSVP-related selectors in `tests/rsvp.spec.ts` and `tests/accessibility-polish.spec.ts` to assert inline feedback.
- Files changed: `src/pages/events/[id].astro`, `tests/event-detail-ui.spec.ts`, `tests/rsvp.spec.ts`, `tests/accessibility-polish.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - For event detail migrations, keep RSVP controls on stable `data-rsvp-button`/`data-status`/`data-active` attributes so existing RSVP behavior and tests remain compatible while restyling.
  - RSVP error/success checks should target the inline feedback panel (`data-test-id="rsvp-feedback-panel"`) and `#rsvp-feedback` message text rather than transient toast selectors.
  - Reusing `buttonVariants` on Astro `<a>` and `<button>` elements keeps interaction styling aligned with shadcn without introducing extra client islands.
---
## 2026-02-12 18:01:57 CET - US-015
- Migrated `src/pages/history.astro` to the shadcn-aligned surface/list shell with tokenized card wrappers for header, empty state, and RSVP history items while preserving all existing data loading, sorting, links, and status behavior.
- Added frontend Playwright coverage in `tests/history-ui.spec.ts` for populated and empty migrated states plus mobile overflow safety on `/history`.
- Verified required quality checks with `pnpm astro check` and `pnpm test --workers=1` (full suite).
- Files changed: `src/pages/history.astro`, `tests/history-ui.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Keep history-page migration assertions split between behavior (`tests/history.spec.ts`) and shell/polish checks (`tests/history-ui.spec.ts`) so layout changes do not weaken data-contract coverage.
  - Reusing shared card slot markers (`data-slot="card"`) on Astro pages provides stable, cross-page assertions for migration UI checks.
  - Continue using the `/api/test/current-user` retry helper pattern in auth-dependent history tests to avoid known intermittent 401 flakes.
---
## 2026-02-12 18:15:32 CET - US-016
- Migrated `src/pages/settings.astro` to the shadcn-aligned shell pattern with tokenized card header/content/footer sections, shared back-link action styling, and status summary surfaces while preserving existing notification settings behavior.
- Preserved settings notification contracts by keeping existing IDs and API calls intact (`/api/settings/notifications`, `/api/settings/push-subscription`) and updated inline feedback rendering to a dedicated shadcn-style panel (`data-test-id="settings-feedback-panel"`).
- Added frontend Playwright coverage in `tests/settings-ui.spec.ts` for migrated shell rendering, notification status surfaces, inline feedback panel behavior, and mobile overflow safety.
- Verified required quality checks with `pnpm astro check` and `pnpm test --workers=1` (full suite).
- Files changed: `src/pages/settings.astro`, `tests/settings-ui.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Keep settings-page script selector IDs (`#permission-status`, `#saved-preference`, `#request-permission`, `#feedback`) stable during UI refactors; both runtime behavior and Playwright coverage depend on them.
  - For settings UI migration checks, pair existing behavior-focused specs (`tests/settings.spec.ts`) with a focused shell/mobile spec (`tests/settings-ui.spec.ts`) to avoid weakening API-behavior assertions.
---
## 2026-02-12 18:34:15 CET - US-017
- Translated user-facing copy to Norwegian across the targeted non-API pages (`index`, `access-denied`, `sign-in`, `sign-up`, `events/new`, `events/[id]/edit`, `events/[id]`, `history`, `settings`) including inline validation/feedback states while preserving routes, payload contracts, and runtime behavior.
- Localized shared shell/component UI text rendered on those pages (`src/layouts/Layout.astro`, `src/components/EventCard.tsx`, `src/components/ShadcnIslandDemo.tsx`) so header actions, badges, and demo interactions match Norwegian interface language.
- Updated Playwright coverage to Norwegian accessible names and messages, fixed localization-related selector collisions, and kept behavior assertions intact across auth, event, RSVP, history, settings, responsive, and primitive suites.
- Verified required quality checks with `pnpm astro check` and `pnpm test --workers=1` (full suite, 111 passed).
- Files changed: `src/pages/index.astro`, `src/pages/access-denied.astro`, `src/pages/sign-in.astro`, `src/pages/sign-up.astro`, `src/pages/events/new.astro`, `src/pages/events/[id]/edit.astro`, `src/pages/events/[id].astro`, `src/pages/history.astro`, `src/pages/settings.astro`, `src/layouts/Layout.astro`, `src/components/EventCard.tsx`, `src/components/ShadcnIslandDemo.tsx`, `tests/access-denied-ui.spec.ts`, `tests/accessibility-polish.spec.ts`, `tests/app-shell.spec.ts`, `tests/auth.spec.ts`, `tests/duplicate-event.spec.ts`, `tests/event-creation.spec.ts`, `tests/event-detail-ui.spec.ts`, `tests/event-edit.spec.ts`, `tests/events.spec.ts`, `tests/history-ui.spec.ts`, `tests/history.spec.ts`, `tests/overlay-primitives.spec.ts`, `tests/responsive.spec.ts`, `tests/rsvp.spec.ts`, `tests/settings.spec.ts`, `tests/settings-ui.spec.ts`, `tests/shadcn-island.spec.ts`, `tests/sign-in-ui.spec.ts`, `tests/sign-up-ui.spec.ts`, `tests/surface-primitives.spec.ts`, `tests/typography-fonts.spec.ts`, `tests/theme-baseline.spec.ts`, `tests/global.setup.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Localization refactors should update both static shell text and inline script-driven feedback text to keep accessibility names and error/loading assertions in sync.
  - Badge/count assertions can become ambiguous after translation (substring overlap); use targeted test IDs (`rsvp-going`, `rsvp-maybe`, `rsvp-not-going`) instead of plain text matching.
  - For external auth widgets (Clerk), keep assertions tolerant with regex around provider-rendered headings while asserting app-owned wrapper copy exactly.
---
## 2026-02-12 20:38:00 CET - US-018
- Removed deprecated legacy UI assets that are no longer used after shadcn migration: deleted `src/components/Welcome.astro`, `src/assets/astro.svg`, and `src/assets/background.svg`.
- Removed unused legacy global CSS toast rules (`.toast-message`) from `src/styles/global.css` since UI feedback now uses inline shadcn-compatible panels.
- Updated `README.md` project structure to reflect current app layout and remove references to deleted starter artifacts.
- Verified required quality checks with `pnpm astro check` and `pnpm test --workers=1` (full suite, 111 passed).
- Files changed: `src/components/Welcome.astro`, `src/assets/astro.svg`, `src/assets/background.svg`, `src/styles/global.css`, `README.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - When a UI migration reaches parity, explicitly search for orphaned starter files and stale selectors (`rg`) and remove them in the same story to keep one authoritative UI path.
  - Keep README structure snippets aligned with real repository contents when deleting legacy scaffolding so onboarding docs do not point to removed files.
---
## 2026-02-12 20:42:53 CET - US-019
- Added migration completion documentation in `docs/shadcn-migration-checklist.md` with explicit old-pattern to shadcn replacement mapping and completion status.
- Updated `README.md` with shadcn usage conventions, migration completion references, and explicit approved exceptions/follow-up items.
- Verified required quality checks with `pnpm astro check` and `pnpm test --workers=1` (full suite, 111 passed).
- Files changed: `README.md`, `docs/shadcn-migration-checklist.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Keep migration documentation split between quick-start conventions (`README.md`) and detailed replacement/status mapping (`docs/shadcn-migration-checklist.md`) so maintainers can update both without ambiguity.
  - Record explicit exceptions (for example provider-rendered auth widgets) in migration docs to prevent future refactors from unintentionally breaking external integrations.
  - When completing documentation-only stories, still run full required gates (`pnpm astro check`, `pnpm test --workers=1`) before marking story status as passed.
---
## 2026-02-12 22:47:34 CET - US-001
- Adopted BiomeJS as the project lint/format gate by adding `@biomejs/biome`, introducing `biome.json`, and wiring scripts for local checks (`pnpm lint` -> `biome check .`), CI checks (`pnpm lint:ci` -> `biome ci .`), and formatting (`pnpm format`, `pnpm format:check`).
- Added PR lint workflow at `.github/workflows/biome.yml` to run Biome on pull requests, and updated `README.md` command docs for local vs CI Biome usage.
- Enabled Biome v2.3 Astro/HTML and Tailwind compatibility in config (`html.experimentalFullSupportEnabled`, CSS `tailwindDirectives`) and applied repository-wide formatting for current files.
- Verified required gates: `pnpm lint`, `pnpm astro check`, `pnpm test:unit`, `pnpm test` (111 passed).
- Files changed: `biome.json`, `.github/workflows/biome.yml`, `package.json`, `README.md`, `pnpm-lock.yaml`, `prd.json`, `progress.txt`, plus repository-wide Biome formatting updates across existing source and test files.
- **Learnings for future iterations**
  - Biome 2.3 Astro support requires explicit `html.experimentalFullSupportEnabled` to lint/format Astro/HTML files.
  - Tailwind v4 `@theme` directives in CSS require enabling `css.parser.tailwindDirectives` in `biome.json`.
  - Keep local and CI Biome commands split: `biome check` locally for iterative fixes, `biome ci` in CI for strict gating.
---
## 2026-02-13 00:01:50 CET - US-002
- Implemented semantic header navigation links in `src/layouts/Layout.astro` with an explicit `<nav aria-label="Hovednavigasjon">`, plain-text link styling, hover underline affordance, route-aware `aria-current="page"`, and persistent active underline indicators while keeping destinations unchanged (`/events/new`, `/history`, `/settings`).
- Added Playwright coverage updates in `tests/app-shell.spec.ts` for semantic nav presence, active-link indicator assertions, and keyboard focus-visible styling checks; tightened header logo heading locator to avoid strict-mode collisions with similarly named content headings.
- Stabilized flaky duplicate-event navigation assertions by adding a bounded retry helper for `page.goto()` in `tests/duplicate-event.spec.ts` to handle intermittent local dev-server aborts during long serial runs.
- Verified required quality checks with `pnpm lint`, `pnpm astro check`, `pnpm test:unit`, and `pnpm test --workers=1` (113 passed).
- Files changed: `src/layouts/Layout.astro`, `tests/app-shell.spec.ts`, `tests/duplicate-event.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Use `aria-current="page"` plus a persistent text-decoration class for active header links so visual active state and accessibility state stay in sync.
  - In authenticated shell tests, scope generic heading locators to `role="banner"` and use `exact: true` when homepage content can contain similar heading text.
  - A lightweight in-spec `page.goto()` retry helper is preferable to inflating global test timeouts when occasional detached-frame navigation flakes appear.
---
