# Codebase Patterns
- Full Playwright runs are most reliable with `pnpm test --workers=1` because many specs mutate shared DB state and can race in parallel.
- For global theme/token assertions, use an `@unauth` Playwright spec on `/access-denied` and validate computed styles from `document.documentElement` and `document.body` to keep tests deterministic.
- Load Google Fonts once in `src/layouts/Layout.astro` and map them via global CSS font tokens (`--font-heading`, `--font-body`) so typography stays consistent across all routes.
- When rendering React `Textarea` components from `.astro` pages, prefer `defaultValue` over children content to avoid accidental `"[object Object]"` rendering in SSR output.

## 2026-02-11 16:34:47 CET - US-001
- Implemented Astro React island support and shadcn scaffold foundations (React integration, aliasing, shadcn config, utility `cn`, and initial `Button` primitive).
- Rendered a React island (`ShadcnIslandDemo`) from `src/pages/index.astro` with `client:load` to validate Astro+React integration in a real page.
- Added Playwright coverage for the new UI integration in `tests/shadcn-island.spec.ts`.
- Files changed: `astro.config.mjs`, `tsconfig.json`, `package.json`, `pnpm-lock.yaml`, `components.json`, `src/lib/utils.ts`, `src/components/ui/button.tsx`, `src/components/ShadcnIslandDemo.tsx`, `src/pages/index.astro`, `tests/shadcn-island.spec.ts`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Astro React TSX components require `@types/react` and `@types/react-dom` in this repo for `pnpm astro check` to pass.
  - Existing test conventions and helper guidance in `tests/AGENTS.md` are accurate; new UI checks should follow `getByRole`/`getByTestId` patterns from there.
---
## 2026-02-11 16:42:43 CET - US-002
- Established a single-source global light-theme baseline in `src/styles/global.css` by formalizing semantic tokens for color, spacing, radius, typography, and elevation, and adding shadcn-compatible semantic aliases (`--background`, `--foreground`, `--card`, etc.).
- Applied token-driven baseline styles to root elements (`html`, `body`, headings, media, links) to remove hardcoded base defaults and ensure consistent styling behavior across pages.
- Added Playwright coverage in `tests/theme-baseline.spec.ts` to validate token presence and computed baseline styles on an unauthenticated route.
- Files changed: `src/styles/global.css`, `tests/theme-baseline.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`, `ralph.sh`.
- **Learnings for future iterations**
  - Keep core semantic aliases (`--background`, `--foreground`, `--primary`, `--ring`) defined alongside legacy `--color-*` tokens so older pages and shadcn primitives can coexist during migration.
  - Theme baseline tests are more stable when they run as `@unauth` against `/access-denied` and assert computed styles instead of auth-dependent page content.
  - Full suite reliability remains best with `pnpm test --workers=1`; auth-dependent specs can fail intermittently under competing state.
---
## 2026-02-11 16:48:38 CET - US-003
- Selected and integrated a polished Google Fonts pairing: `Lora` for headings and `Manrope` for body/UI text.
- Loaded font assets globally in `src/layouts/Layout.astro` with `preconnect` + stylesheet link, and wired typography roles through global tokens in `src/styles/global.css`.
- Documented the font choices and usage roles in `README.md`.
- Added Playwright coverage in `tests/typography-fonts.spec.ts` and updated baseline typography assertion in `tests/theme-baseline.spec.ts`.
- Files changed: `src/layouts/Layout.astro`, `src/styles/global.css`, `README.md`, `tests/theme-baseline.spec.ts`, `tests/typography-fonts.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Keep all font loading centralized in `src/layouts/Layout.astro` so every route inherits the same typography without per-page duplication.
  - Font-family Playwright assertions should use `toContain()` for the selected family name, since rendered stacks include browser-specific fallbacks.
- Run full Playwright verification with `pnpm test --workers=1` when validating UI stories to avoid parallel state races in this codebase.
---
## 2026-02-11 16:59:55 CET - US-004
- Added shadcn form primitives `Input`, `Label`, `Textarea`, and `Select`, plus a `src/components/ui/index.ts` barrel for consistent UI imports.
- Replaced event creation form controls in `src/pages/events/new.astro` with the new primitives while preserving existing IDs/names and submit behavior.
- Expanded the shadcn island demo to include a working `Select` and added Playwright assertions for the new select interaction and primitive slots.
- Files changed: `package.json`, `pnpm-lock.yaml`, `src/components/ui/input.tsx`, `src/components/ui/label.tsx`, `src/components/ui/textarea.tsx`, `src/components/ui/select.tsx`, `src/components/ui/index.ts`, `src/components/ShadcnIslandDemo.tsx`, `src/pages/events/new.astro`, `tests/event-creation.spec.ts`, `tests/shadcn-island.spec.ts`, `tests/AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations**
  - Import shared UI primitives from `@/components/ui` to keep migration imports consistent across pages and islands.
  - For React form primitives rendered in Astro pages, preserve existing element IDs so current scripts and Playwright locators keep working without refactors.
  - `data-slot` attributes on shadcn primitives provide stable selectors for focused UI tests when role/text assertions are not specific enough.
---
