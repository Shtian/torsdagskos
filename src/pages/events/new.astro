---



import Layout from '../../layouts/Layout.astro';
import { buttonVariants } from '@/components/ui/button';
import NewEventForm from '@/components/NewEventForm';

// Ensure user is authenticated
const { userId } = Astro.locals.auth();
if (!userId) {
  return Astro.redirect('/sign-in');
}

// Check if this is a duplicate request
const isDuplicate = Astro.url.searchParams.get('duplicate') === 'true';
const prefillTitle = Astro.url.searchParams.get('title') || '';
const prefillDescription = Astro.url.searchParams.get('description') || '';
const prefillLocation = Astro.url.searchParams.get('location') || '';
const prefillMapLink = Astro.url.searchParams.get('mapLink') || '';
---

<Layout
  title="Opprett nytt arrangement - Torsdagskos"
  description="Opprett et nytt Torsdagskos-arrangement med tittel, dato, sted og valgfri informasjon."
>
  <section class="mx-auto mt-6 w-full max-w-4xl pb-8 sm:mt-10" data-test-id="new-event-shell">
    <div class="mb-6">
      <a href="/" class:list={[buttonVariants({ variant: 'ghost' }), 'pl-0 no-underline']}>&larr; Tilbake til arrangementer</a>
    </div>

    {isDuplicate && (
      <div
        data-slot="card"
        data-test-id="duplicate-banner"
        class="bg-primary/5 text-card-foreground mb-6 rounded-xl border border-primary/30 px-5 py-4 shadow-sm"
      >
        <p class="m-0 text-sm font-medium text-foreground">
          Duplisert fra forrige arrangement
        </p>
        <p class="mt-1 mb-0 text-sm text-muted-foreground">
          Tittel, beskrivelse, sted og kartlenke ble forh√•ndsutfylt.
          Angi dato og klokkeslett for dette arrangementet.
        </p>
      </div>
    )}

    <NewEventForm
      client:load
      prefillTitle={prefillTitle}
      prefillDescription={prefillDescription}
      prefillLocation={prefillLocation}
      prefillMapLink={prefillMapLink}
    />
  </section>
</Layout>
