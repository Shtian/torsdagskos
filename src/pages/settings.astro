---







import Layout from '../layouts/Layout.astro';
import { buttonVariants } from '@/components/ui/button';
import SettingsNotifications from '@/components/SettingsNotifications';
import { ensureLocalUser } from '@/lib/local-user-sync';

const { userId } = Astro.locals.auth();
if (!userId) {
  return Astro.redirect('/sign-in');
}

const currentUser = await ensureLocalUser(Astro, userId);

const notificationsEnabled = currentUser?.browserNotificationsEnabled ?? false;
const vapidPublicKey = import.meta.env.PUBLIC_VAPID_PUBLIC_KEY || '';
---

<Layout
  title="Innstillinger - Torsdagskos"
  description="Administrer varslingstillatelser i nettleseren og preferanser for push-abonnement."
>
  <section class="mx-auto mt-6 w-full max-w-4xl pb-8 sm:mt-10" aria-labelledby="settings-title" data-test-id="settings-shell">
    <div class="mb-6">
      <a href="/" class:list={[buttonVariants({ variant: 'ghost' }), 'pl-0 no-underline']}>&larr; Tilbake til arrangementer</a>
    </div>

    <article data-slot="card" class="bg-card text-card-foreground rounded-xl border shadow-sm" aria-labelledby="notifications-title">
      <div data-slot="card-header" class="space-y-2 border-b px-6 py-5 sm:px-8">
        <h1 id="settings-title" class="m-0 text-3xl text-(--color-accent-dark) sm:text-4xl">Innstillinger</h1>
        <h2 id="notifications-title" class="m-0 text-xl text-foreground">Nettleslervarsler</h2>
        <p class="m-0 text-sm text-muted-foreground">
          Aktiver nettleslervarsler for Ã¥ motta varsler direkte i denne nettleseren.
        </p>
      </div>

      <SettingsNotifications
        client:load
        initialNotificationsEnabled={notificationsEnabled}
        vapidPublicKey={vapidPublicKey}
      />
    </article>
  </section>
</Layout>
